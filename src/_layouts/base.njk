{%- set absolutePageUrl %}{{ page.url | htmlBaseUrl(site.url) }}{% endset %}
<!DOCTYPE html>
<html lang="en-us"
      class="text-gray-950 bg-gray-50 dark:text-gray-50 dark:bg-gray-950">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title or site.title }}</title>
    <meta name="description" content="{{ description or site.description }}">
    <meta name="author" content="{{ author or site.author }}">
    <meta name="generator" content="{{ eleventy.generator }}">
    <link rel="canonical" href="{{ absolutePageUrl }}">
    <meta property="og:title"
          content="{%- if title -%}{{ title }} - {{ site.title }}{%- else -%}{{ site.title }}{%- endif -%}">
    {%- set ogImageUrl %}https://screenshot.11ty.app/{{ (site.url + '/og' + page.url + '?updatedAt=' + updatedAt.getTime() ) | urlencode }}/opengraph/{% endset %}
    <meta property="og:image" content="{{ ogImageUrl }}">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="{{ site.title }}">
    <meta property="og:url" content="{{ absolutePageUrl }}">
    <meta property="og:locale" content="en_us">
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:image" content="{{ ogImageUrl }}" />
    <link rel="alternate"
          href="/feeds/blog.xml"
          type="application/atom+xml"
          title="{{ site.title }}">
    <link rel="preload"
          href="/static/fonts/BricolageGrotesque.woff2"
          as="font"
          type="font/woff2"
          crossorigin>
    <link rel="preload"
          href="/static/fonts/InterVariable.woff2"
          as="font"
          type="font/woff2"
          crossorigin>
    <link rel="preload"
          href="/static/fonts/InterVariable-Italic.woff2"
          as="font"
          type="font/woff2"
          crossorigin>
    {%- getBundle "html", "preload" %}
    {# djlint: off #}
    <style>{% getBundle "css" %}</style>
    {# djlint: on #}
    {%- css %}
      {% include "../_static/css/fonts.css" %}
    {% endcss %}
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/devicon/devicon.min.css">
    <script>
      (function() {
        const THEME_STORAGE_KEY = 'theme';
        const THEME_DATA_ATTR = 'data-theme';

        function getStoredTheme() {
          return localStorage.getItem(THEME_STORAGE_KEY);
        }

        function getSystemTheme() {
          return window.matchMedia?.('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }

        function getCurrentState() {
          const stored = getStoredTheme();
          if (stored === 'light') return 'light';
          if (stored === 'dark') return 'dark';
          return 'auto';
        }

        function applyTheme(theme) {
          document.documentElement.setAttribute(THEME_DATA_ATTR, theme);
        }

        function persistTheme(state) {
          if (state === 'auto') {
            localStorage.removeItem(THEME_STORAGE_KEY);
            applyTheme(getSystemTheme());
          } else {
            localStorage.setItem(THEME_STORAGE_KEY, state);
            applyTheme(state);
          }
        }

        function getNextState(currentState) {
          if (currentState === 'light') return 'dark';
          if (currentState === 'dark') return 'auto';
          return 'light';
        }

        function updateThemeButton(state) {
          const button = document.getElementById('theme-toggle');
          if (!button) return;

          const appliedTheme = state === 'auto' ? getSystemTheme() : state;

          document.querySelectorAll('[data-theme-state]').forEach(icon => {
            icon.classList.add('hidden');
          });

          const activeIcon = document.querySelector(`[data-theme-state="${state}"]`);
          if (activeIcon) {
            activeIcon.classList.remove('hidden');
          }

          const labels = {
            light: 'Theme: Light. Click to switch to dark mode',
            dark: 'Theme: Dark. Click to use system theme',
            auto: `Theme: Auto (currently ${appliedTheme}). Click to switch to light mode`
          };

          button.setAttribute('aria-label', labels[state]);
        }

        const initialState = getCurrentState();
        persistTheme(initialState);

        document.addEventListener('DOMContentLoaded', function() {
          const currentState = getCurrentState();
          updateThemeButton(currentState);

          const button = document.getElementById('theme-toggle');
          if (button) {
            button.addEventListener('click', () => {
              const currentState = getCurrentState();
              const nextState = getNextState(currentState);
              persistTheme(nextState);
              updateThemeButton(nextState);
            });
          }

          window.matchMedia?.('(prefers-color-scheme: dark)').addEventListener('change', e => {
            if (getCurrentState() === 'auto') {
              const newTheme = e.matches ? 'dark' : 'light';
              applyTheme(newTheme);
              updateThemeButton('auto');
            }
          });
        });
      })();
    </script>
    <script data-goatcounter="https://joshthomasdev.goatcounter.com/count"
            async
            src="//gc.zgo.at/count.js"></script>
    <link href="mailto:josh@joshthomas.dev" rel="me">
    <link href="https://github.com/joshuadavidthomas" rel="me">
    <link href="https://joshthomas.dev/@josh" rel="me">
    <link href="https://social.joshthomas.dev/@josh" rel="me">
  </head>
  <body {% if class.body -%}class="{{ class.body }}"{%- endif -%}>
    {{ content | safe }}
    {% getBundle "fontawesome" %}
    {%- js %}
      {% include "../../public/static/js/goatcounter.js" %}
    {% endjs %}
    <script type="module" src="{% getBundleFileUrl "js" %}"></script>
    {% getBundle "js", "modules" %}
  </body>
</html>
